# =============================================================================
# Example: Market Data Contract and Subscription
# =============================================================================
# Demonstrates bilateral agreement with grantor and grantee duties.
# =============================================================================

@prefix adalbert:     <https://vocabulary.bigbank/adalbert/> .
@prefix adalbert-dc:  <https://vocabulary.bigbank/adalbert/contracts/> .
@prefix adalbert-md:  <https://vocabulary.bigbank/adalbert/market-data/> .
@prefix adalbert-gov: <https://vocabulary.bigbank/adalbert/governance/> .
@prefix xsd:          <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:         <http://www.w3.org/2000/01/rdf-schema#> .
@prefix prov:         <http://www.w3.org/ns/prov#> .

# =============================================================================
# AGENTS
# =============================================================================

<https://data.bigbank/agents/market-data-team> a adalbert:Agent ;
    rdfs:label "Market Data Team" .

<https://data.bigbank/agents/quant-research> a adalbert:Agent ;
    rdfs:label "Quantitative Research" ;
    adalbert:memberOf <https://data.bigbank/agents/trading-division> .

<https://data.bigbank/agents/trading-division> a adalbert:Agent ;
    rdfs:label "Trading Division" .

# =============================================================================
# ASSETS
# =============================================================================

<https://data.bigbank/assets/equity-prices> a adalbert:Asset ;
    rdfs:label "Real-time Equity Prices" ;
    adalbert:partOf <https://data.bigbank/assets/market-data> .

<https://data.bigbank/assets/market-data> a adalbert:Asset ;
    rdfs:label "Market Data Lake" .

# =============================================================================
# DATA CONTRACT (Offer)
# =============================================================================
# This is the template offer from the data provider.
# Subscribers accept this to create a Subscription (Agreement).

<https://data.bigbank/offers/equity-feed-v2> a adalbert-dc:DataContract ;
    rdfs:label "Equity Price Feed Contract v2" ;
    adalbert:grantor <https://data.bigbank/agents/market-data-team> ;
    adalbert:target <https://data.bigbank/assets/equity-prices> ;
    adalbert-dc:contractState adalbert-dc:Published ;
    adalbert-dc:effectiveDate "2026-01-01T00:00:00Z"^^xsd:dateTime ;
    prov:wasRevisionOf <https://data.bigbank/offers/equity-feed-v1> ;
    
    # ----- PROVIDER COMMITMENTS (Grantor Duties) -----
    
    # SLA: Daily delivery by 6:30 AM
    adalbert:clause [
        a adalbert:Duty ;
        rdfs:label "Daily data delivery" ;
        adalbert:subject <https://data.bigbank/agents/market-data-team> ;
        adalbert:action adalbert-md:deliver ;
        adalbert:object <https://data.bigbank/assets/equity-prices> ;
        adalbert:condition [
            a adalbert:AtomicConstraint ;
            adalbert:leftOperand adalbert:currentDateTime ;
            adalbert:constraintOperator adalbert:gte ;
            adalbert:rightOperand "06:00:00"^^xsd:time
        ] ;
        adalbert:deadline "06:30:00"^^xsd:time
    ] ;
    
    # SLA: 14-day notice for schema changes
    adalbert:clause [
        a adalbert:Duty ;
        rdfs:label "Schema change notification" ;
        adalbert:subject <https://data.bigbank/agents/market-data-team> ;
        adalbert:action adalbert-md:notify ;
        adalbert:object <https://data.bigbank/assets/schema-changes> ;
        adalbert:deadline "P14D"^^xsd:duration
    ] ;
    
    # ----- CONSUMER RIGHTS (Grantee Privileges) -----
    
    # Display real-time data
    adalbert:clause [
        a adalbert:Privilege ;
        rdfs:label "Real-time display" ;
        adalbert:subject adalbert:currentAgent ;
        adalbert:action adalbert-md:display ;
        adalbert:object <https://data.bigbank/assets/equity-prices> ;
        adalbert:condition [
            a adalbert:AtomicConstraint ;
            adalbert:leftOperand adalbert-md:timeliness ;
            adalbert:constraintOperator adalbert:eq ;
            adalbert:rightOperand adalbert-md:realtime
        ]
    ] ;
    
    # Create non-substitutive derivatives
    adalbert:clause [
        a adalbert:Privilege ;
        rdfs:label "Derivative creation" ;
        adalbert:subject adalbert:currentAgent ;
        adalbert:action adalbert-md:derive ;
        adalbert:object <https://data.bigbank/assets/equity-prices> ;
        adalbert:condition [
            a adalbert:AtomicConstraint ;
            adalbert:leftOperand adalbert-md:derivationType ;
            adalbert:constraintOperator adalbert:eq ;
            adalbert:rightOperand adalbert-md:nonSubstitutive
        ]
    ] ;
    
    # ----- CONSUMER OBLIGATIONS (Grantee Duties) -----
    
    # Monthly usage reporting
    adalbert:clause [
        a adalbert:Duty ;
        rdfs:label "Usage reporting" ;
        adalbert:subject adalbert:currentAgent ;
        adalbert:action adalbert-md:report ;
        adalbert:object <https://data.bigbank/assets/usage-stats> ;
        adalbert:deadline "P30D"^^xsd:duration
    ] ;
    
    # ----- RESTRICTIONS (Prohibitions) -----
    
    # No external distribution
    adalbert:clause [
        a adalbert:Prohibition ;
        rdfs:label "No redistribution" ;
        adalbert:subject adalbert:currentAgent ;
        adalbert:action adalbert-gov:distribute ;
        adalbert:object <https://data.bigbank/assets/equity-prices>
    ] .


# =============================================================================
# SUBSCRIPTION (Agreement)
# =============================================================================
# Quant Research has subscribed to the equity feed contract.
# This is a bilateral agreement with duties on BOTH parties.

<https://data.bigbank/agreements/quant-equity-2026> a adalbert-dc:Subscription ;
    rdfs:label "Quant Research Equity Feed 2026" ;
    adalbert-dc:subscribesTo <https://data.bigbank/offers/equity-feed-v2> ;
    adalbert:grantor <https://data.bigbank/agents/market-data-team> ;
    adalbert:grantee <https://data.bigbank/agents/quant-research> ;
    adalbert-dc:effectiveDate "2026-01-15T00:00:00Z"^^xsd:dateTime ;
    adalbert-dc:expirationDate "2026-12-31T23:59:59Z"^^xsd:dateTime ;
    
    # ===== GRANTOR DUTIES (Data Team's Obligations) =====
    
    adalbert:clause <https://data.bigbank/duties/delivery-2026-001> ;
    adalbert:clause <https://data.bigbank/duties/notify-2026-001> ;
    
    # ===== GRANTEE PRIVILEGES (Quant's Rights) =====
    
    adalbert:clause [
        a adalbert:Privilege ;
        adalbert:subject <https://data.bigbank/agents/quant-research> ;
        adalbert:action adalbert-md:display ;
        adalbert:object <https://data.bigbank/assets/equity-prices> ;
        adalbert:condition [
            a adalbert:AtomicConstraint ;
            adalbert:leftOperand adalbert-md:timeliness ;
            adalbert:constraintOperator adalbert:eq ;
            adalbert:rightOperand adalbert-md:realtime
        ]
    ] ;
    
    adalbert:clause [
        a adalbert:Privilege ;
        adalbert:subject <https://data.bigbank/agents/quant-research> ;
        adalbert:action adalbert-md:derive ;
        adalbert:object <https://data.bigbank/assets/equity-prices> ;
        adalbert:condition [
            a adalbert:AtomicConstraint ;
            adalbert:leftOperand adalbert-md:derivationType ;
            adalbert:constraintOperator adalbert:eq ;
            adalbert:rightOperand adalbert-md:nonSubstitutive
        ]
    ] ;
    
    # ===== GRANTEE DUTIES (Quant's Obligations) =====
    
    adalbert:clause <https://data.bigbank/duties/report-2026-001> ;
    
    # ===== PROHIBITIONS =====
    
    adalbert:clause [
        a adalbert:Prohibition ;
        adalbert:subject <https://data.bigbank/agents/quant-research> ;
        adalbert:action adalbert-gov:distribute ;
        adalbert:object <https://data.bigbank/assets/equity-prices>
    ] .


# =============================================================================
# DUTY INSTANCES (with lifecycle state)
# =============================================================================
# These are instantiated from the contract clauses with tracked state.

# Grantor duty: Daily delivery
<https://data.bigbank/duties/delivery-2026-001> a adalbert:Duty ;
    rdfs:label "Daily delivery duty (2026-01-15)" ;
    adalbert:subject <https://data.bigbank/agents/market-data-team> ;
    adalbert:action adalbert-md:deliver ;
    adalbert:object <https://data.bigbank/assets/equity-prices> ;
    adalbert:condition [
        a adalbert:AtomicConstraint ;
        adalbert:leftOperand adalbert:currentDateTime ;
        adalbert:constraintOperator adalbert:gte ;
        adalbert:rightOperand "06:00:00"^^xsd:time
    ] ;
    adalbert:deadline "06:30:00"^^xsd:time ;
    adalbert:dutyState adalbert:Fulfilled .  # Successfully delivered

# Grantor duty: Schema change notification
<https://data.bigbank/duties/notify-2026-001> a adalbert:Duty ;
    rdfs:label "Schema notification duty" ;
    adalbert:subject <https://data.bigbank/agents/market-data-team> ;
    adalbert:action adalbert-md:notify ;
    adalbert:object <https://data.bigbank/assets/schema-changes> ;
    adalbert:deadline "P14D"^^xsd:duration ;
    adalbert:dutyState adalbert:Pending .  # No schema change yet

# Grantee duty: Monthly reporting
<https://data.bigbank/duties/report-2026-001> a adalbert:Duty ;
    rdfs:label "January usage report" ;
    adalbert:subject <https://data.bigbank/agents/quant-research> ;
    adalbert:action adalbert-md:report ;
    adalbert:object <https://data.bigbank/assets/usage-stats> ;
    adalbert:deadline "P30D"^^xsd:duration ;
    adalbert:dutyState adalbert:Active .  # Due date approaching
