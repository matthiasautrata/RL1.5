# =============================================================================
# Example: Internal Data Access Policy
# =============================================================================
# Shows role-based access with purpose constraints and consent tracking,
# using ODRL terms for all standard constructs.
# =============================================================================

@prefix odrl:         <http://www.w3.org/ns/odrl/2/> .
@prefix adalbert:     <https://vocabulary.bigbank/adalbert/> .
@prefix adalbert-due: <https://vocabulary.bigbank/adalbert/due/> .
@prefix xsd:          <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:         <http://www.w3.org/2000/01/rdf-schema#> .

# =============================================================================
# PARTIES (Hierarchy)
# =============================================================================

<https://data.bigbank/agents/hr-analytics> a odrl:Party ;
    rdfs:label "HR Analytics Team" ;
    adalbert:memberOf <https://data.bigbank/agents/hr-division> .

<https://data.bigbank/agents/hr-division> a odrl:Party ;
    rdfs:label "Human Resources Division" .

<https://data.bigbank/agents/compliance-team> a odrl:Party ;
    rdfs:label "Compliance Team" .

# =============================================================================
# ASSETS (Hierarchy)
# =============================================================================

<https://data.bigbank/assets/employee-compensation> a odrl:Asset ;
    rdfs:label "Employee Compensation Data" ;
    adalbert:partOf <https://data.bigbank/assets/employee-data> .

<https://data.bigbank/assets/employee-performance> a odrl:Asset ;
    rdfs:label "Employee Performance Reviews" ;
    adalbert:partOf <https://data.bigbank/assets/employee-data> .

<https://data.bigbank/assets/employee-data> a odrl:Asset ;
    rdfs:label "Employee Data Lake" .

# =============================================================================
# POLICY SET: HR Data Access Controls
# =============================================================================
# This is a Set (no parties) â€” applies to anyone matching the conditions.

<https://data.bigbank/policies/hr-data-access> a odrl:Set ;
    rdfs:label "HR Data Access Policy" ;
    odrl:profile <https://vocabulary.bigbank/adalbert/> ;
    odrl:target <https://data.bigbank/assets/employee-data> ;

    # ===== RULE 1: HR Analytics can read for analytics purposes =====

    odrl:permission [
        a odrl:Permission ;
        rdfs:label "HR analytics read access" ;
        odrl:assignee <https://data.bigbank/agents/hr-analytics> ;
        odrl:action adalbert-due:read ;
        odrl:target <https://data.bigbank/assets/employee-data> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:purpose ;
            odrl:operator odrl:eq ;
            odrl:rightOperand adalbert-due:analytics
        ]
    ] ;

    # ===== RULE 2: Compliance can read for compliance purposes =====

    odrl:permission [
        a odrl:Permission ;
        rdfs:label "Compliance audit access" ;
        odrl:assignee <https://data.bigbank/agents/compliance-team> ;
        odrl:action adalbert-due:read ;
        odrl:target <https://data.bigbank/assets/employee-data> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:purpose ;
            odrl:operator odrl:eq ;
            odrl:rightOperand adalbert-due:compliance
        ]
    ] ;

    # ===== RULE 3: Anyone reading must log access =====

    odrl:obligation [
        a odrl:Duty ;
        rdfs:label "Mandatory audit logging" ;
        odrl:assignee adalbert:currentAgent ;
        odrl:action adalbert-due:log ;
        odrl:target <https://data.bigbank/assets/access-log> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:classification ;
            odrl:operator odrl:eq ;
            odrl:rightOperand adalbert-due:confidential
        ] ;
        adalbert:deadline "PT1H"^^xsd:duration  # Log within 1 hour
    ] ;

    # ===== RULE 4: No external distribution =====

    odrl:prohibition [
        a odrl:Prohibition ;
        rdfs:label "No external sharing" ;
        odrl:assignee adalbert:currentAgent ;
        odrl:action adalbert-due:distribute ;
        odrl:target <https://data.bigbank/assets/employee-data>
    ] ;

    # ===== RULE 5: No use for model training =====

    odrl:prohibition [
        a odrl:Prohibition ;
        rdfs:label "No ML training" ;
        odrl:assignee adalbert:currentAgent ;
        odrl:action adalbert-due:use ;
        odrl:target <https://data.bigbank/assets/employee-data> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:processingMode ;
            odrl:operator odrl:eq ;
            odrl:rightOperand adalbert-due:modelTraining
        ]
    ] ;

    # ===== RULE 6: Production only =====

    odrl:prohibition [
        a odrl:Prohibition ;
        rdfs:label "Production environment only" ;
        odrl:assignee adalbert:currentAgent ;
        odrl:action adalbert-due:use ;
        odrl:target <https://data.bigbank/assets/employee-data> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:environment ;
            odrl:operator odrl:isNoneOf ;
            odrl:rightOperand (adalbert-due:production adalbert-due:staging)
        ]
    ] .


# =============================================================================
# POLICY SET: Compensation Data (Stricter)
# =============================================================================
# More restrictive policy for sensitive compensation data.

<https://data.bigbank/policies/compensation-access> a odrl:Set ;
    rdfs:label "Compensation Data Access Policy" ;
    odrl:profile <https://vocabulary.bigbank/adalbert/> ;
    odrl:target <https://data.bigbank/assets/employee-compensation> ;

    # Only HR Division (not just analytics sub-team)
    odrl:permission [
        a odrl:Permission ;
        rdfs:label "HR Division compensation access" ;
        odrl:assignee <https://data.bigbank/agents/hr-division> ;
        odrl:action adalbert-due:read ;
        odrl:target <https://data.bigbank/assets/employee-compensation> ;
        odrl:constraint [
            a odrl:LogicalConstraint ;
            odrl:and (
                [
                    a odrl:Constraint ;
                    odrl:leftOperand adalbert-due:purpose ;
                    odrl:operator odrl:isAnyOf ;
                    odrl:rightOperand (adalbert-due:compliance adalbert-due:operations)
                ]
                [
                    a odrl:Constraint ;
                    odrl:leftOperand adalbert-due:legalBasis ;
                    odrl:operator odrl:eq ;
                    odrl:rightOperand adalbert-due:legitimateInterest
                ]
            )
        ]
    ] ;

    # Retention limit: delete after 7 years
    odrl:obligation [
        a odrl:Duty ;
        rdfs:label "Retention limit" ;
        odrl:assignee adalbert:currentAgent ;
        odrl:action adalbert-due:delete ;
        odrl:target <https://data.bigbank/assets/employee-compensation> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:retentionPeriod ;
            odrl:operator odrl:gt ;
            odrl:rightOperand "P7Y"^^xsd:duration
        ]
    ] ;

    # Mandatory anonymization for any analytics
    odrl:obligation [
        a odrl:Duty ;
        rdfs:label "Anonymization required" ;
        odrl:assignee adalbert:currentAgent ;
        odrl:action adalbert-due:anonymize ;
        odrl:target <https://data.bigbank/assets/employee-compensation> ;
        odrl:constraint [
            a odrl:Constraint ;
            odrl:leftOperand adalbert-due:purpose ;
            odrl:operator odrl:eq ;
            odrl:rightOperand adalbert-due:analytics
        ]
    ] .
