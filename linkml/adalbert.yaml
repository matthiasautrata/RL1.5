# ==============================================================================
# Adalbert LinkML Schema — Contract Authoring
# ==============================================================================
# Author-friendly schema for Adalbert data contracts and subscriptions.
#
# Slot names are what a data steward writes. slot_uri carries the semantic
# mapping to ODRL/Adalbert for downstream RDF generation.
#
# Bilateral structure is positional: provider_obligations vs.
# consumer_obligations. The translator derives subject/object roles.
#
# See DESIGN.md for rationale.
# ==============================================================================

id: https://vocabulary.bigbank/adalbert/linkml/contracts
name: adalbert_contracts
title: Adalbert Contract Authoring Schema
description: >-
  LinkML schema for authoring Adalbert data contracts in YAML.
  Produces instance data that can be validated, translated to RDF/JSON-LD,
  or loaded into a contract registry.
version: "0.7"
license: https://creativecommons.org/licenses/by/4.0/

prefixes:
  linkml: https://w3id.org/linkml/
  adalbert: https://vocabulary.bigbank/adalbert/
  adalbert_due: https://vocabulary.bigbank/adalbert/due/
  odrl: http://www.w3.org/ns/odrl/2/
  rdfs: http://www.w3.org/2000/01/rdf-schema#
  dcterms: http://purl.org/dc/terms/
  prov: http://www.w3.org/ns/prov#
  xsd: http://www.w3.org/2001/XMLSchema#
  ac: https://vocabulary.bigbank/adalbert/linkml/contracts/

default_prefix: ac
default_range: string

imports:
  - linkml:types
  - adalbert_vocab

# ==============================================================================
# CLASSES
# ==============================================================================

classes:

  # --------------------------------------------------------------------------
  # DataContract — the primary authoring target
  # --------------------------------------------------------------------------

  DataContract:
    class_uri: adalbert:DataContract
    tree_root: true
    description: >-
      A provider's offer specifying data assets, usage permissions, provider
      SLAs, consumer obligations, and restrictions. The primary document
      type for contract authoring.
    slots:
      - id
      - label
      - description
      - provider
      - target
      - state
      - effective_date
      - expiration_date
      - previous_version
      - provider_obligations
      - consumer_obligations
      - permissions
      - prohibitions

  # --------------------------------------------------------------------------
  # Subscription — an activated contract
  # --------------------------------------------------------------------------

  Subscription:
    class_uri: adalbert:Subscription
    description: >-
      An activated data contract binding provider and consumer.
      References a DataContract and adds the consumer party.
    slots:
      - id
      - label
      - description
      - contract
      - provider
      - consumer
      - target
      - state
      - effective_date
      - expiration_date
      - provider_obligations
      - consumer_obligations
      - permissions
      - prohibitions

  # --------------------------------------------------------------------------
  # Rule components
  # --------------------------------------------------------------------------

  Obligation:
    class_uri: odrl:Duty
    description: >-
      A duty owed by one party. Which party is determined by list membership:
      provider_obligations or consumer_obligations.
    slots:
      - label
      - action
      - rule_target
      - recurrence
      - deadline
      - constraint

  Permission:
    class_uri: odrl:Permission
    description: >-
      A usage right granted to consumers.
    slots:
      - label
      - action
      - rule_target
      - assignee
      - constraint

  Prohibition:
    class_uri: odrl:Prohibition
    description: >-
      A restriction on data use.
    slots:
      - label
      - action
      - rule_target
      - assignee
      - constraint

  Constraint:
    class_uri: odrl:Constraint
    description: >-
      An atomic condition on a rule. Single left/operator/right comparison.
    slots:
      - left
      - operator
      - right

# ==============================================================================
# SLOTS
# ==============================================================================

slots:

  # --------------------------------------------------------------------------
  # Identity & description
  # --------------------------------------------------------------------------

  id:
    identifier: true
    description: Short identifier (e.g., market-prices-v2)
    range: string
    required: true

  label:
    slot_uri: rdfs:label
    description: Human-readable title
    range: string

  description:
    slot_uri: dcterms:description
    description: Longer description of the contract or subscription
    range: string

  # --------------------------------------------------------------------------
  # Parties
  # --------------------------------------------------------------------------

  provider:
    slot_uri: odrl:assigner
    description: Data provider (party short name or URI)
    range: string
    required: true

  consumer:
    slot_uri: odrl:assignee
    description: Data consumer (party short name or URI)
    range: string

  assignee:
    slot_uri: odrl:assignee
    description: Party granted the permission or bound by the prohibition
    range: string

  # --------------------------------------------------------------------------
  # Assets
  # --------------------------------------------------------------------------

  target:
    slot_uri: odrl:target
    description: >-
      Data asset(s) covered by the contract. Rules without an explicit
      target inherit from this list (when single-valued).
    range: string
    multivalued: true
    required: true

  rule_target:
    slot_uri: odrl:target
    description: >-
      Override target for a specific rule. If absent, inherits from
      the contract-level target.
    range: string

  # --------------------------------------------------------------------------
  # Temporal
  # --------------------------------------------------------------------------

  effective_date:
    slot_uri: adalbert:effectiveDate
    description: When the contract/subscription becomes effective
    range: datetime

  expiration_date:
    slot_uri: adalbert:expirationDate
    description: When the contract/subscription expires
    range: datetime

  # --------------------------------------------------------------------------
  # Lifecycle
  # --------------------------------------------------------------------------

  state:
    slot_uri: adalbert:state
    description: Current lifecycle state
    range: State

  # --------------------------------------------------------------------------
  # Versioning
  # --------------------------------------------------------------------------

  previous_version:
    slot_uri: prov:wasRevisionOf
    description: ID of the prior contract version
    range: string

  contract:
    slot_uri: adalbert:subscribesTo
    description: DataContract this subscription activates
    range: string
    required: true

  # --------------------------------------------------------------------------
  # Rule lists (bilateral structure)
  # --------------------------------------------------------------------------

  provider_obligations:
    slot_uri: odrl:obligation
    description: >-
      Obligations borne by the provider (SLAs: delivery, notification,
      schema conformance). Subject is implicitly the provider.
    range: Obligation
    multivalued: true
    inlined_as_list: true

  consumer_obligations:
    slot_uri: odrl:obligation
    description: >-
      Obligations borne by the consumer (reporting, audit).
      Subject is implicitly the consumer.
    range: Obligation
    multivalued: true
    inlined_as_list: true

  permissions:
    slot_uri: odrl:permission
    description: Usage rights granted to consumers
    range: Permission
    multivalued: true
    inlined_as_list: true

  prohibitions:
    slot_uri: odrl:prohibition
    description: Restrictions on data use
    range: Prohibition
    multivalued: true
    inlined_as_list: true

  # --------------------------------------------------------------------------
  # Obligation-specific
  # --------------------------------------------------------------------------

  action:
    slot_uri: odrl:action
    description: The action being permitted, required, or prohibited
    range: Action
    required: true

  recurrence:
    slot_uri: adalbert:recurrence
    description: >-
      RFC 5545 RRULE defining the schedule for recurring duties.
      Example: FREQ=DAILY;BYHOUR=6;BYMINUTE=0
    range: string

  deadline:
    slot_uri: adalbert:deadline
    description: >-
      Fulfillment window. ISO 8601 duration (PT30M, P14D) or
      absolute datetime.
    range: string

  # --------------------------------------------------------------------------
  # Constraint fields
  # --------------------------------------------------------------------------

  constraint:
    description: Single atomic constraint on a rule
    range: Constraint
    inlined: true

  left:
    slot_uri: odrl:leftOperand
    description: The operand being evaluated
    range: Operand
    required: true

  operator:
    slot_uri: odrl:operator
    description: Comparison operator
    range: Operator
    required: true

  right:
    slot_uri: odrl:rightOperand
    description: >-
      Value to compare against. Free-form string — may be a concept
      value (internal, analytics), a literal, or a URI reference.
    range: string
    required: true
