# ==============================================================================
# Adalbert Core — ODRL 2.2 Profile Extension
# ==============================================================================
# LinkML schema for Adalbert's core extensions to ODRL 2.2.
# Mirrors the constructs in ontology/adalbert-core.ttl.
#
# Imports: adalbert-odrl.yaml
# Used by: adalbert-due.yaml, schemas/examples/
#
# Gap register:
#   - owl:TransitiveProperty on partOf/memberOf — not expressible in LinkML;
#     noted in slot annotations; runtime engine enforces transitivity
#   - owl:disjointWith on Subscription/DataContract — not expressible; SHACL-only
#   - rdfs:domain [ owl:unionOf (...) ] — LinkML domain: is single class; accepted
#   - rdfs:subPropertyOf generation — LinkML is_a on slots generates
#     rdfs:subPropertyOf in gen-owl; CHECK if this works as expected
#   - owl:oneOf on State individuals — expressed as LinkML enum; semantics preserved
# ==============================================================================

id: https://vocabulary.bigbank/adalbert/linkml/core
name: adalbert_core
title: Adalbert Core Schema
description: >-
  LinkML schema for Adalbert's core ODRL 2.2 profile extensions.
  Defines DataContract, Subscription, State lifecycle, duty extensions
  (deadline, recurrence), party roles (subject, object), hierarchy properties
  (partOf, memberOf), and runtime references.
version: "0.7"

prefixes:
  linkml: https://w3id.org/linkml/
  adalbert: https://vocabulary.bigbank/adalbert/
  odrl: http://www.w3.org/ns/odrl/2/
  rdfs: http://www.w3.org/2000/01/rdf-schema#
  xsd: http://www.w3.org/2001/XMLSchema#
  dcterms: http://purl.org/dc/terms/
  prov: http://www.w3.org/ns/prov#
  skos: http://www.w3.org/2004/02/skos/core#

default_range: string

imports:
  - linkml:types
  - adalbert-odrl

# ==============================================================================
# ENUMS
# ==============================================================================

enums:

  State:
    description: >-
      Unified lifecycle state for duties and contracts.
      Equivalent to owl:oneOf on adalbert:State individuals in the OWL ontology.
      GAP: owl:oneOf semantics (closed enumeration at OWL level) not expressible
      beyond LinkML enum; functionally equivalent for authoring.
    permissible_values:
      Pending:
        meaning: adalbert:Pending
        description: Condition not yet satisfied; not yet in force.
      Active:
        meaning: adalbert:Active
        description: Condition satisfied, action required; in force.
      Fulfilled:
        meaning: adalbert:Fulfilled
        description: Action performed; obligations complete.
      Violated:
        meaning: adalbert:Violated
        description: Deadline passed without performance; breached.

# ==============================================================================
# CLASSES
# ==============================================================================

classes:

  # --------------------------------------------------------------------------
  # Contract classes (subClassOf ODRL policy types)
  # --------------------------------------------------------------------------

  DataContract:
    class_uri: adalbert:DataContract
    is_a: Offer
    description: >-
      A data provider's offer specifying data assets, usage permissions,
      provider SLAs, consumer obligations, and restrictions.
      Subtype of odrl:Offer; becomes a Subscription (Agreement) when accepted.
    slots:
      - id
      - label
      - description
      - profile
      - assigner
      - target
      - state
      - effectiveDate
      - expirationDate
      - previousVersion
      - permission
      - prohibition
      - obligation
    slot_usage:
      obligation:
        range: Adalbert_Duty
        description: >-
          Duty rules in this DataContract. Uses Adalbert_Duty to allow
          adalbert:subject, adalbert:object, adalbert:deadline, adalbert:recurrence,
          and adalbert:state on duty instances.

  Subscription:
    class_uri: adalbert:Subscription
    is_a: Agreement
    description: >-
      An activated DataContract binding provider and consumer.
      Subtype of odrl:Agreement; bilateral (both parties may have duties).
      GAP: owl:disjointWith DataContract — not expressible in LinkML; SHACL-only.
    slots:
      - id
      - label
      - description
      - profile
      - subscribesTo
      - assigner
      - assignee
      - target
      - state
      - effectiveDate
      - expirationDate
      - permission
      - prohibition
      - obligation
    slot_usage:
      obligation:
        range: Adalbert_Duty
        description: >-
          Duty rules in this Subscription. Uses Adalbert_Duty to allow
          adalbert:subject, adalbert:object, adalbert:deadline, adalbert:recurrence,
          and adalbert:state on duty instances.

  # --------------------------------------------------------------------------
  # Runtime reference classes
  # --------------------------------------------------------------------------

  RuntimeReference:
    class_uri: adalbert:RuntimeReference
    description: >-
      A value resolved at evaluation time rather than at authoring time.
      Subclasses: CurrentAgent, CurrentDateTime.
    slots:
      - id
      - label

  CurrentAgent:
    class_uri: adalbert:currentAgent
    is_a: RuntimeReference
    description: >-
      The requesting agent, resolved at evaluation time.
      Dual-typed as RuntimeReference and odrl:Party in OWL.
      GAP: dual typing not expressible in LinkML; document in annotation.
      Use for constraint identity comparisons; do NOT use as assignee.

  CurrentDateTime:
    class_uri: adalbert:currentDateTime
    is_a: RuntimeReference
    description: >-
      The evaluation timestamp, resolved at evaluation time.
      Equivalent to odrl:dateTime in constraint evaluation.
      Dual-typed as RuntimeReference and odrl:LeftOperand in OWL.

  # --------------------------------------------------------------------------
  # Extended Duty class (with Adalbert slots)
  # --------------------------------------------------------------------------

  Adalbert_Duty:
    class_uri: odrl:Duty
    is_a: Duty
    description: >-
      An ODRL Duty extended with Adalbert-specific slots: deadline, recurrence,
      subject (duty bearer), object (affected party), state.
      Uses the same class_uri as odrl:Duty — this is a view with extended slots.
    slots:
      - subject
      - object
      - deadline
      - recurrence
      - state

  # --------------------------------------------------------------------------
  # Extended Asset and Party (with Adalbert hierarchy slots)
  # --------------------------------------------------------------------------

  Adalbert_Asset:
    class_uri: odrl:Asset
    is_a: Asset
    description: >-
      An ODRL Asset extended with Adalbert's partOf hierarchy property.
      GAP: partOf is owl:TransitiveProperty in OWL; LinkML expresses the
      slot but cannot enforce transitivity; runtime engine handles this.
    slots:
      - partOf

  Adalbert_Party:
    class_uri: odrl:Party
    is_a: Party
    description: >-
      An ODRL Party extended with Adalbert's memberOf hierarchy property.
      GAP: memberOf is owl:TransitiveProperty in OWL; LinkML expresses the
      slot but cannot enforce transitivity; runtime engine handles this.
    slots:
      - memberOf

  # --------------------------------------------------------------------------
  # Extended LogicalConstraint (with adalbert:not)
  # --------------------------------------------------------------------------

  Adalbert_LogicalConstraint:
    class_uri: odrl:LogicalConstraint
    is_a: LogicalConstraint
    description: >-
      A LogicalConstraint extended with adalbert:not for logical negation.
      ODRL defines and/or but lacks negation; Adalbert adds adalbert:not.
    slots:
      - not

# ==============================================================================
# SLOTS
# ==============================================================================

slots:

  # --------------------------------------------------------------------------
  # Lifecycle
  # --------------------------------------------------------------------------

  state:
    slot_uri: adalbert:state
    description: >-
      Current lifecycle state. Used on both duties (tracked during evaluation)
      and contracts/subscriptions (administrative).
      GAP: rdfs:domain [ owl:unionOf (odrl:Duty adalbert:DataContract
      adalbert:Subscription) ] — LinkML domain: is single class; accepted as
      documented gap.
    range: State

  # --------------------------------------------------------------------------
  # Temporal
  # --------------------------------------------------------------------------

  effectiveDate:
    slot_uri: adalbert:effectiveDate
    description: When the contract or subscription becomes effective.
    range: datetime

  expirationDate:
    slot_uri: adalbert:expirationDate
    description: When the contract or subscription expires.
    range: datetime

  deadline:
    slot_uri: adalbert:deadline
    description: >-
      Time constraint for duty fulfillment.
      Supports two forms:
        - ISO 8601 duration (e.g., PT30M, P14D) — relative to activation
        - ISO 8601 datetime (e.g., 2026-12-31T23:59:59Z) — absolute deadline
      GAP: no rdfs:range in OWL (union of datatypes); range: string here;
      SHACL enforces allowed types.
    range: string
    pattern: "^(P|\\d{4}-)"

  recurrence:
    slot_uri: adalbert:recurrence
    description: >-
      RFC 5545 RRULE defining when duty instances are generated.
      Example: FREQ=DAILY;BYHOUR=6;BYMINUTE=0
      Each instance follows the standard duty lifecycle independently.
    range: string
    pattern: "^FREQ=(SECONDLY|MINUTELY|HOURLY|DAILY|WEEKLY|MONTHLY|YEARLY)"

  # --------------------------------------------------------------------------
  # Contract/Subscription-specific
  # --------------------------------------------------------------------------

  subscribesTo:
    slot_uri: adalbert:subscribesTo
    description: The DataContract this Subscription activates.
    range: string

  previousVersion:
    slot_uri: prov:wasRevisionOf
    description: ID of the prior version of this contract.
    range: string

  # --------------------------------------------------------------------------
  # Duty party roles
  # --------------------------------------------------------------------------

  subject:
    slot_uri: adalbert:subject
    description: >-
      Party bearing the duty (must perform the action).
      rdfs:subPropertyOf odrl:assignee in OWL.
      GAP: is_a on slots generates rdfs:subPropertyOf in gen-owl — CHECK.
      Aligns with W3C Market Data md:subject.
    range: string
    # is_a: assignee  # Would generate rdfs:subPropertyOf odrl:assignee

  object:
    slot_uri: adalbert:object
    description: >-
      Party affected by or receiving the result of the duty action.
      rdfs:subPropertyOf odrl:function in OWL.
      Generic alternative to ODRL Common Vocabulary party functions
      (informedParty, compensatedParty, etc.).
      Aligns with W3C Market Data md:object.
    range: string
    # is_a: function  # Would generate rdfs:subPropertyOf odrl:function

  # --------------------------------------------------------------------------
  # Hierarchy properties
  # --------------------------------------------------------------------------

  partOf:
    slot_uri: adalbert:partOf
    description: >-
      Asset contained in a larger asset. Transitive hierarchy.
      rdfs:subPropertyOf odrl:partOf in OWL.
      GAP: owl:TransitiveProperty — not expressible in LinkML; runtime engine
      enforces transitivity when evaluating policy target inheritance.
    range: string

  memberOf:
    slot_uri: adalbert:memberOf
    description: >-
      Party that is a member of a group or organization. Transitive hierarchy.
      rdfs:subPropertyOf odrl:partOf in OWL.
      GAP: owl:TransitiveProperty — not expressible in LinkML; runtime engine
      enforces transitivity when resolving party membership.
    range: string

  # --------------------------------------------------------------------------
  # Operand resolution
  # --------------------------------------------------------------------------

  resolutionPath:
    slot_uri: adalbert:resolutionPath
    description: >-
      Dot-separated path from canonical root to value.
      Path must start with: agent, asset, or context.
      Examples: agent.role, asset.classification, context.purpose.
      Resolution: resolve(path, Env) -> Value
    range: string
    pattern: "^(agent|asset|context)\\."

  # --------------------------------------------------------------------------
  # Logical negation
  # --------------------------------------------------------------------------

  not:
    slot_uri: adalbert:not
    description: >-
      Logical negation on a constraint.
      ODRL defines odrl:and and odrl:or but lacks negation.
      Adalbert adds adalbert:not following the same pattern as ODRL.
    range: Constraint
    inlined: true
