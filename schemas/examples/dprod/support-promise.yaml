# ==============================================================================
# DPROD Example 7: Support Promise (Multi-Channel CRM)
# ==============================================================================
# YAML equivalent of Example 7 from examples/dprod-translated.ttl
# Schema: schemas/adalbert-core.yaml
#
# DPROD original: dprod:ProviderSupportPromise with multi-channel support:
#   - email support (response within 4 hours)
#   - chat support (response within 30 minutes)
#   - phone support (business hours, 1-hour response)
#
# Translation decisions:
#   dprod:provideSupport -> not directly mappable; expressed as odrl:Duty +
#   adalbert-due:notify for each support channel, using constraints to specify
#   channel type and deadline for response time SLA.
#
#   Each support channel becomes a separate notify duty with:
#     - deadline = response time SLA
#     - constraint = channel type (and optionally serviceWindow)
# ==============================================================================

schema: https://vocabulary.bigbank/adalbert/linkml/core

prefixes:
  odrl: "http://www.w3.org/ns/odrl/2/"
  adalbert: "https://vocabulary.bigbank/adalbert/"
  adalbert_due: "https://vocabulary.bigbank/adalbert/due/"
  ex: "https://example.com/"

parties:
  - id: "ex:support-team"
    label: "Support Operations Team"

assets:
  - id: "ex:crm-data"
    label: "CRM Integration Data"
  - id: "ex:crm-changes"
    label: "CRM Change Notifications"

type: DataContract
id: "ex:contract-crm-support"
label: "CRM Integration Support Contract"
description: "CRM data integration with multi-channel support: email, chat, and phone."
profile:
  - "https://vocabulary.bigbank/adalbert/"
  - "https://vocabulary.bigbank/adalbert/due/"
assigner: "ex:support-team"
target: "ex:crm-data"
state: Active
effectiveDate: "2026-01-01T00:00:00Z"
expirationDate: "2026-12-31T23:59:59Z"

obligation:

  # Provider duty: daily delivery at 07:00
  - id: "ex:contract-crm-support/duties/daily-delivery"
    label: "Daily CRM data delivery"
    subject: "ex:support-team"
    action: "adalbert_due:deliver"
    recurrence: "FREQ=DAILY;BYHOUR=7;BYMINUTE=0"
    deadline: "PT30M"
    # target: inherited from policy (ex:crm-data)

  # Provider duty: schema change notification
  - id: "ex:contract-crm-support/duties/change-notification"
    label: "CRM schema change notification"
    subject: "ex:support-team"
    action: "adalbert_due:notify"
    target: "ex:crm-changes"
    deadline: "P14D"

  # Support channel: email (4-hour response SLA)
  # DPROD: dprod:ProviderSupportPromise { channel: "email"; responseTime: "PT4H" }
  - id: "ex:contract-crm-support/duties/email-support"
    label: "Email support response"
    subject: "ex:support-team"
    action: "adalbert_due:notify"
    deadline: "PT4H"
    constraint:
      - id: "ex:contract-crm-support/constraints/channel-email"
        leftOperand: "adalbert_due:channel"
        operator: "odrl:eq"
        rightOperand: "email"

  # Support channel: chat (30-minute response SLA)
  # DPROD: dprod:ProviderSupportPromise { channel: "chat"; responseTime: "PT30M" }
  - id: "ex:contract-crm-support/duties/chat-support"
    label: "Chat support response"
    subject: "ex:support-team"
    action: "adalbert_due:notify"
    deadline: "PT30M"
    constraint:
      - id: "ex:contract-crm-support/constraints/channel-chat"
        leftOperand: "adalbert_due:channel"
        operator: "odrl:eq"
        rightOperand: "chat"

  # Support channel: phone (business hours, 1-hour response SLA)
  # DPROD: dprod:ProviderSupportPromise { channel: "phone"; responseTime: "PT1H"; availability: "business hours" }
  # Compound constraint: channel=phone AND serviceWindow=business-hours
  - id: "ex:contract-crm-support/duties/phone-support"
    label: "Phone support response (business hours)"
    subject: "ex:support-team"
    action: "adalbert_due:notify"
    deadline: "PT1H"
    constraint:
      - id: "ex:contract-crm-support/constraints/phone-business-hours"
        type: LogicalConstraint
        and:
          - id: "ex:contract-crm-support/constraints/channel-phone"
            leftOperand: "adalbert_due:channel"
            operator: "odrl:eq"
            rightOperand: "phone"
          - id: "ex:contract-crm-support/constraints/service-window-business"
            leftOperand: "adalbert_due:serviceWindow"
            operator: "odrl:eq"
            rightOperand: "business-hours"

permission:

  - id: "ex:contract-crm-support/permissions/read"
    label: "CRM data read access"
    action: "odrl:read"

  # Consumer can modify (for integration updates) â€” internal recipients only
  - id: "ex:contract-crm-support/permissions/modify-internal"
    label: "CRM data modification (internal)"
    action: "odrl:modify"
    constraint:
      - id: "ex:contract-crm-support/constraints/recipient-internal"
        leftOperand: "adalbert_due:recipientType"
        operator: "odrl:eq"
        rightOperand: "adalbert_due:internalRecipient"

prohibition:

  - id: "ex:contract-crm-support/prohibitions/no-external-distribute"
    label: "No external distribution"
    action: "odrl:distribute"
