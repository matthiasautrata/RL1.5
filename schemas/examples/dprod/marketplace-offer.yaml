# ==============================================================================
# DPROD Example 8: Marketplace Offer with Pricing Tiers (Geospatial Data)
# ==============================================================================
# YAML equivalent of Example 8 from examples/dprod-translated.ttl
# Schema: schemas/adalbert-core.yaml
#
# DPROD original: dprod:DataOffer published on a marketplace with:
#   - free sample tier (no constraint)
#   - premium tier (paid: derive + aggregate + modify + internal distribution)
#   - provider promises (timeliness, schema, SLA)
#
# Translation decisions:
#   dprod:DataOffer       -> adalbert:DataContract (Adalbert unifies these)
#   Pricing tiers         -> separate permissions with subscriptionTier constraints
#   dprod:download        -> odrl:permission + odrl:read (free: sample only)
#   dprod:stream          -> odrl:permission + odrl:read (premium: full dataset)
#   dprod:deriveInsights  -> odrl:permission + odrl:derive (premium constraint)
#   dprod:aggregate       -> odrl:permission + odrl:aggregate (premium constraint)
#   dprod:enrich          -> odrl:permission + odrl:modify (premium constraint)
#   dprod:shareInternally -> odrl:permission + odrl:distribute + internal constraint
#
# Scope note: Adalbert does not model pricing directly. Access tiers are
# expressed as permissions with constraints on subscriptionTier. Pricing
# metadata (schema:PriceSpecification) remains outside Adalbert scope.
# ==============================================================================

schema: https://vocabulary.bigbank/adalbert/linkml/core

prefixes:
  odrl: "http://www.w3.org/ns/odrl/2/"
  adalbert: "https://vocabulary.bigbank/adalbert/"
  adalbert_due: "https://vocabulary.bigbank/adalbert/due/"
  ex: "https://example.com/"

parties:
  - id: "ex:marketplace-provider"
    label: "Data Marketplace Provider"

assets:
  - id: "ex:geo-data"
    label: "Geospatial Analytics Data"
  - id: "ex:geo-schema"
    label: "Geospatial Data Schema"
  - id: "ex:geo-sample"
    label: "Geospatial Sample Dataset"

type: DataContract
id: "ex:contract-geo-marketplace"
label: "Geospatial Analytics Marketplace Offer"
description: "Marketplace data offer with free sample and premium tiers for geospatial analytics."
profile:
  - "https://vocabulary.bigbank/adalbert/"
  - "https://vocabulary.bigbank/adalbert/due/"
assigner: "ex:marketplace-provider"
target: "ex:geo-data"
state: Active
effectiveDate: "2026-01-01T00:00:00Z"

obligation:

  # Provider duty: daily delivery at 04:00
  - id: "ex:contract-geo-marketplace/duties/daily-delivery"
    label: "Daily geospatial data delivery"
    subject: "ex:marketplace-provider"
    action: "adalbert_due:deliver"
    recurrence: "FREQ=DAILY;BYHOUR=4;BYMINUTE=0"
    deadline: "PT1H"
    # target: inherited from policy (ex:geo-data)

  # Provider duty: schema conformance
  - id: "ex:contract-geo-marketplace/duties/schema-conformance"
    label: "Geospatial schema conformance"
    subject: "ex:marketplace-provider"
    action: "adalbert_due:conformTo"
    target: "ex:geo-schema"

  # Provider duty: 99.5% availability SLA
  - id: "ex:contract-geo-marketplace/duties/availability-sla"
    label: "Availability SLA"
    subject: "ex:marketplace-provider"
    action: "adalbert_due:conformTo"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/availability-99-5"
        leftOperand: "adalbert_due:availability"
        operator: "odrl:gteq"
        rightOperand: "99.5"

  # Consumer duty: quarterly usage reporting (all tiers)
  - id: "ex:contract-geo-marketplace/duties/quarterly-reporting"
    label: "Quarterly usage reporting"
    action: "adalbert_due:report"
    recurrence: "FREQ=MONTHLY;INTERVAL=3;BYMONTHDAY=1"
    deadline: "P10D"
    # subject: omitted in Offer; filled upon subscription
    # target: inherited from policy (ex:geo-data)

permission:

  # FREE TIER: read sample data (no constraint)
  # DPROD: dprod:download on sample dataset
  - id: "ex:contract-geo-marketplace/permissions/free-sample"
    label: "Free tier: sample read access"
    action: "odrl:read"
    target: "ex:geo-sample"

  # PREMIUM TIER: full dataset read (streaming access)
  # DPROD: dprod:stream
  - id: "ex:contract-geo-marketplace/permissions/premium-read"
    label: "Premium: streaming read access"
    action: "odrl:read"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/tier-premium-read"
        leftOperand: "adalbert_due:subscriptionTier"
        operator: "odrl:eq"
        rightOperand: "premium"

  # PREMIUM TIER: derive insights
  # DPROD: dprod:deriveInsights
  - id: "ex:contract-geo-marketplace/permissions/premium-derive"
    label: "Premium: derive insights"
    action: "odrl:derive"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/tier-premium-derive"
        leftOperand: "adalbert_due:subscriptionTier"
        operator: "odrl:eq"
        rightOperand: "premium"

  # PREMIUM TIER: aggregate
  # DPROD: dprod:aggregate
  - id: "ex:contract-geo-marketplace/permissions/premium-aggregate"
    label: "Premium: aggregate"
    action: "odrl:aggregate"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/tier-premium-aggregate"
        leftOperand: "adalbert_due:subscriptionTier"
        operator: "odrl:eq"
        rightOperand: "premium"

  # PREMIUM TIER: enrich (modify with additional data)
  # DPROD: dprod:enrich
  - id: "ex:contract-geo-marketplace/permissions/premium-enrich"
    label: "Premium: enrich data"
    action: "odrl:modify"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/tier-premium-enrich"
        leftOperand: "adalbert_due:subscriptionTier"
        operator: "odrl:eq"
        rightOperand: "premium"

  # PREMIUM TIER: internal distribution only
  # DPROD: dprod:shareInternally
  # Compound constraint: subscriptionTier=premium AND recipientType=internal
  - id: "ex:contract-geo-marketplace/permissions/premium-share-internal"
    label: "Premium: internal distribution"
    action: "odrl:distribute"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/premium-and-internal"
        type: LogicalConstraint
        and:
          - id: "ex:contract-geo-marketplace/constraints/tier-premium-distribute"
            leftOperand: "adalbert_due:subscriptionTier"
            operator: "odrl:eq"
            rightOperand: "premium"
          - id: "ex:contract-geo-marketplace/constraints/recipient-internal-geo"
            leftOperand: "adalbert_due:recipientType"
            operator: "odrl:eq"
            rightOperand: "adalbert_due:internalRecipient"

prohibition:

  # No external redistribution (any tier)
  - id: "ex:contract-geo-marketplace/prohibitions/no-external-redistribute"
    label: "No external redistribution"
    action: "odrl:distribute"
    constraint:
      - id: "ex:contract-geo-marketplace/constraints/recipient-external"
        leftOperand: "adalbert_due:recipientType"
        operator: "odrl:eq"
        rightOperand: "adalbert_due:externalRecipient"

  # No anonymize-and-resell
  - id: "ex:contract-geo-marketplace/prohibitions/no-anonymize-resell"
    label: "No anonymize-and-resell"
    action: "odrl:anonymize"
